<!DOCTYPE html>
<html>

<head>
    <title>Minion Configurator</title>
    <meta charset="utf-8">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<div id="webgl-container">
</div>
<div id="gui-container" style="position:absolute;z-index:1;top:0;left:0">
</div>

<body>
<script type="text/javascript" src="js/three.js"></script>
<script type="text/javascript" src="js/OrbitControls.js"></script>
<script type="text/javascript" src="js/ColladaLoader.js"></script>
<script type="text/javascript" src="js/dat.gui.js"></script>
<script type="text/javascript">
var minion;
var goggles;
var body;
var jeans;
var hands;
var boots;
var configuration;
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
var renderer = new THREE.WebGLRenderer();

renderer.setClearColor(0xeeeeee, 1.0);
renderer.setSize(window.innerWidth, window.innerHeight);
var webglContainer = document.getElementById('webgl-container');
webglContainer.appendChild(renderer.domElement);

initMenu();

// camera controls
var camControls = new THREE.OrbitControls(camera, renderer.domElement);
camControls.damping = 0.2;
camControls.addEventListener('change', render);

// window resize handler
window.addEventListener('resize', onWindowResize, false);

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
    render();
}

var axes = new THREE.AxisHelper(20);
scene.add(axes);

var grid = new THREE.GridHelper(40, 1);

// create the ground plane
var planeGeometry = new THREE.PlaneGeometry(80, 80, 10, 10);
var planeMaterial = new THREE.MeshLambertMaterial({
    color: 0xffffff
});
var plane = new THREE.Mesh(planeGeometry, planeMaterial);
plane.rotation.x = -0.5 * Math.PI;
plane.position.x = 0;
plane.position.y = -0.05;
plane.position.z = 0;
scene.add(plane);

// ---- 3D CONTENT CREATION -----------------------------------------------------

var loader = new THREE.ColladaLoader();
loader.options.convertUpAxis = true;
loader.load('minion.dae', function (collada) {
    collada.scene.traverse(function (child) {
        if (child instanceof THREE.SkinnedMesh) {
            var animation = new THREE.Animation(child, child.geometry.animation);
            animation.play();
            camera.lookAt(child.position);
        }
    });
    minion = collada.scene;
    goggles = minion.getObjectById("goggles");
    body = minion.getObjectById("body");
    jeans = minion.getObjectById("jeans");
    hands = minion.getObjectById("hands");
    boots = minion.getObjectById("boots");
    showGoggles();

        // keep
    minion.position.set(0, 0, 0);
    minion.scale.set(10, 10, 10);
    scene.add(minion);
    camControls.panUp(10);
    camControls.update();
    render();
});

function showGoggles() {
    goggles.children[0].material.materials[1].transparent = true;
    goggles.children[0].material.materials[1].opacity = 0.2;
}

function hideGoggles() {
    goggles.visible = false;
}

// ---- END OF 3D CONTENT CREATION ---------------------------------------------

// position and point the camera to the center of the scene
camera.position.x = -35;
camera.position.y = 25;
camera.position.z = 35;
camera.lookAt(scene.position);

// add subtle ambient lighting
var ambientLight = new THREE.AmbientLight(0x333333);
scene.add(ambientLight);

// add spotlight
var spotLight = new THREE.SpotLight(0xffffff);
spotLight.position.set(-80, 70, 90);
scene.add(spotLight);

// add headlight
var headLight = new THREE.PointLight(0x888888, 1.0);
headLight.position.set(camera.position.x, camera.position.y, camera.position.z);
scene.add(headLight);

var gui = new dat.GUI({
    autoPlace: false
});
var guiContainer = document.getElementById('gui-container');
gui.domElement.style.position = 'absolute';
gui.domElement.style.top = '150px';
gui.domElement.style.left = '5px';
gui.domElement.style.height = '400px';
guiContainer.appendChild(gui.domElement);

var minionConfigurationFolder = gui.addFolder('Minion configurator');
minionConfigurationFolder.open();

var bodyColorChooser = minionConfigurationFolder.addColor(configuration, 'bodyColor').name("Minion color").listen();
bodyColorChooser.onChange(function (colorValue) {
    body.children[0].material.materials[0].color = new THREE.Color(colorValue);
    render();
});

var jeansColorChooser = minionConfigurationFolder.addColor(configuration, 'jeansColor').name("Jeans color").listen();
jeansColorChooser.onChange(function (colorValue) {
    jeans.children[0].material.color = new THREE.Color(colorValue);
    render();
});

var handsColorChooser = minionConfigurationFolder.addColor(configuration, 'handsColor').name("Hands color").listen();
handsColorChooser.onChange(function (colorValue) {
    hands.children[0].material.color = new THREE.Color(colorValue);
    render();
});

var bootsColorChooser = minionConfigurationFolder.addColor(configuration, 'bootsColor').name("Boots color").listen();
bootsColorChooser.onChange(function (colorValue) {
    boots.children[0].material.color = new THREE.Color(colorValue);
    render();
});
gui.open();

function initMenu() {
    configuration = new function () {
        this.bodyColor = 0xEBC700;
        this.jeansColor = 0x0051E7;
        this.handsColor = 0x232408;
        this.bootsColor = 0x232408;
    };
}

// init and call render function
function render() {
    headLight.position.set(camera.position.x, camera.position.y, camera.position.z);
    renderer.render(scene, camera);
}
render();

</script>
</body>

</html>